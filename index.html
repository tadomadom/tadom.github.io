<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Am√©rica Latina com GeoNames</title>
  <style>
    body{font-family:sans-serif;max-width:800px;margin:30px auto;padding:0 16px}
    label{display:block;margin-top:12px;font-weight:bold}
    select{width:100%;padding:8px;margin-top:4px}
    .info{font-size:0.85em;color:#555;margin-top:4px}
  </style>
</head>
<body>
  <h1>Pa√≠ses da Am√©rica Latina (via GeoNames)</h1>

  <label for="country">Pa√≠s</label>
  <select id="country">
    <option value="">Carregando pa√≠ses...</option>
  </select>
  <div class="info" id="countryInfo"></div>

  <label for="state">Estado/Prov√≠ncia</label>
  <select id="state" disabled>
    <option value="">Selecione um pa√≠s</option>
  </select>
  <div class="info" id="stateInfo"></div>

  <label for="city">Cidade</label>
  <select id="city" disabled>
    <option value="">Selecione um estado</option>
  </select>
  <div class="info" id="cityInfo"></div>

  <script>
    // üîë Substitua por seu username em geonames.org
    const USERNAME = tadom; // ‚Üê‚Üê‚Üê IMPORTANTE!

    const latinCountryCodes = ["AR","BO","BR","CL","CO","CR","CU","DO","EC","SV","GT","HN","MX","NI","PA","PY","PE","PR","UY","VE"];

    const countrySelect = document.getElementById("country");
    const stateSelect = document.getElementById("state");
    const citySelect = document.getElementById("city");

    // Carregar pa√≠ses
    async function loadCountries() {
      try {
        const res = await fetch(`http://api.geonames.org/countryInfoJSON?username=${USERNAME}&lang=pt&style=short`);
        const data = await res.json();
        const countries = data.geonames.filter(c => latinCountryCodes.includes(c.countryCode));
        countries.sort((a, b) => a.countryName.localeCompare(b.countryName, 'pt'));

        countrySelect.innerHTML = '<option value="">-- selecione --</option>';
        countries.forEach(c => {
          const opt = document.createElement("option");
          opt.value = c.countryCode;
          opt.textContent = c.countryName;
          opt.dataset.geonameId = c.geonameId;
          countrySelect.appendChild(opt);
        });
        document.getElementById("countryInfo").textContent = `Pa√≠ses: ${countries.length}`;
      } catch (e) {
        countrySelect.innerHTML = '<option>Erro ao carregar</option>';
        console.error(e);
      }
    }

    // Carregar estados (admin1)
    async function loadStates(countryCode) {
      stateSelect.disabled = true;
      stateSelect.innerHTML = '<option>Carregando...</option>';
      try {
        const res = await fetch(`http://api.geonames.org/adminJSON?country=${countryCode}&username=${USERNAME}&lang=pt`);
        const states = await res.json();
        if (!states || !states.length) {
          stateSelect.innerHTML = '<option>Nenhum estado encontrado</option>';
          return;
        }
        stateSelect.disabled = false;
        stateSelect.innerHTML = '<option>-- selecione um estado --</option>';
        states.forEach(s => {
          const opt = document.createElement("option");
          opt.value = s.adminCode1;
          opt.textContent = s.name;
          opt.dataset.geonameId = s.geonameId;
          stateSelect.appendChild(opt);
        });
        document.getElementById("stateInfo").textContent = `Estados: ${states.length}`;
      } catch (e) {
        stateSelect.innerHTML = '<option>Erro ao carregar estados</option>';
        console.error(e);
      }
    }

    // Carregar cidades (featureClass=P, pop > 0)
    async function loadCities(geonameId) {
      citySelect.disabled = true;
      citySelect.innerHTML = '<option>Carregando...</option>';
      try {
        const res = await fetch(
          `http://api.geonames.org/childrenJSON?geonameId=${geonameId}&username=${USERNAME}&featureClass=P&lang=pt&maxRows=100`
        );
        const data = await res.json();
        const cities = data.geonames || [];
        if (!cities.length) {
          citySelect.innerHTML = '<option>Nenhuma cidade encontrada</option>';
          return;
        }
        citySelect.disabled = false;
        citySelect.innerHTML = '<option>-- selecione uma cidade --</option>';
        cities.forEach(c => {
          const opt = document.createElement("option");
          opt.value = c.name;
          opt.textContent = c.name;
          citySelect.appendChild(opt);
        });
        document.getElementById("cityInfo").textContent = `Cidades: ${cities.length}`;
      } catch (e) {
        citySelect.innerHTML = '<option>Erro ao carregar cidades</option>';
        console.error(e);
      }
    }

    // Eventos
    countrySelect.addEventListener("change", (e) => {
      const code = e.target.value;
      if (!code) {
        stateSelect.innerHTML = '<option>Selecione um pa√≠s</option>';
        citySelect.innerHTML = '<option>Selecione um estado</option>';
        stateSelect.disabled = true;
        citySelect.disabled = true;
        return;
      }
      loadStates(code);
    });

    stateSelect.addEventListener("change", (e) => {
      const geonameId = e.target.selectedOptions[0]?.dataset?.geonameId;
      if (!geonameId) {
        citySelect.innerHTML = '<option>Selecione um estado</option>';
        citySelect.disabled = true;
        return;
      }
      loadCities(geonameId);
    });

    // Iniciar
    loadCountries();
  </script>
</body>
</html>

